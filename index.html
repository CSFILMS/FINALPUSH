<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Terminal Access</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  
  <!-- Critical resource preloading for faster initial render -->
  <link rel="preload" href="fonts/fonts/3270-Regular.ttf" as="font" type="font/ttf" crossorigin>
  <link rel="preload" href="script.js?v=6" as="script">
  
  <!-- DNS prefetch for external resources -->
  <link rel="dns-prefetch" href="//fonts.googleapis.com">
  
  <!-- Early loading indicator -->
  <style id="loading-styles">
    #loading-indicator {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: #00FF00;
      font-family: monospace;
      font-size: 1.2rem;
      z-index: 10001;
      text-shadow: 0 0 10px #00FF00;
    }
    
    #loading-indicator::after {
      content: '';
      animation: dots 1.5s infinite;
    }
    
    @keyframes dots {
      0%, 20% { content: ''; }
      40% { content: '.'; }
      60% { content: '..'; }
      80%, 100% { content: '...'; }
    }
  </style>
  
  <style>
    /* CRITICAL Font Definition - Loaded immediately */
    @font-face {
      font-family: 'IBM3270';
      src: url('fonts/fonts/3270-Regular.ttf') format('truetype'),
           url('fonts/fonts/3270-Regular.otf') format('opentype');
      font-weight: normal;
      font-style: normal;
      font-display: swap;
    }
    
    /* LAZY-LOADED Fonts - Only loaded when requested via JavaScript */
    /* These will be dynamically added to reduce initial load time */
    
    :root { 
      --fg:#D4D4D4; 
      --bg:#000; 
      --accent:#00FF00; 
      --soft:#66FF66;
      --font-family: monospace;
    }
    html, body { height:100%; }
    
    /* COMPLETE RESET */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    /* FORCE NO SCROLLING */
    html {
      overflow: hidden;
      height: 100%;
      width: 100%;
    }
    
    body {
      overflow: hidden;
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: var(--bg);
      color: var(--fg);
      font-family: var(--font-family);
      font-size: 1.4rem;
      line-height: 1.6;
      user-select: none;
      min-height: 100vh;
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      cursor: none;
    }
    
    /* CRT scanline effect */
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: repeating-linear-gradient(
        0deg,
        transparent 0px,
        transparent 2px,
        rgba(0, 255, 0, 0.03) 2px,
        rgba(0, 255, 0, 0.03) 4px
      );
      pointer-events: none;
      z-index: 99998;
    }
    
    /* Black scanlines on top */
    body::after {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: repeating-linear-gradient(
        0deg,
        rgba(0, 0, 0, 0.20) 0px,
        rgba(0, 0, 0, 0.20) 2px,
        transparent 2px,
        transparent 4px
      );
      pointer-events: none;
      z-index: 99999;
    }
    
    /* MAIN CONTAINER - FIXED SIZE, NO SCROLL */
    #main-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      overflow: hidden;
      background: #000;
    }
    
    /* TERMINAL POSITIONING - MOVED UP */
    #terminal {
      position: absolute;
      top: 12vh;
      left: 12vw;
      right: 12vw;
      max-width: 56vw;
    }
    
    /* INPUT STYLING - MADE SMALLER */
    input {
      background: #000;
      border: none;
      color: #00FF00;
      font-family: var(--font-family);
      font-size: inherit;
      outline: none;
      width: 26vw;
      caret-color: #00FF00;
    }
    
    /* BLINKING CURSOR */
    input:focus {
      animation: blink 1s infinite;
    }
    
    @keyframes blink {
      0%, 50% { opacity: 1; }
      51%, 100% { opacity: 0; }
    }
    
    /* TEXT ELEMENTS - REDUCED SPACING */
    .line {
      margin: 0.8vh 0;
    }
    
    #boot, #prompt, #msg, input {
      text-shadow: 0 0 2px var(--accent), 0 0 12px var(--accent);
    }
    
    /* Custom cursor element */
    #custom-cursor {
      position: fixed;
      width: 10px;
      height: 10px;
      background: var(--accent);
      border-radius: 50%;
      pointer-events: none;
      z-index: 10000;
      mix-blend-mode: difference;
      display: none;
    }

    /* HIDE ALL SCROLLBARS */
    ::-webkit-scrollbar { display: none; width: 0; height: 0; }
    html, body { scrollbar-width: none; -ms-overflow-style: none; }
    
    /* MOBILE RESPONSIVE FIXES */
    @media screen and (max-width: 768px) {
      body {
        font-size: 1.0rem; /* Smaller base font size for mobile */
        line-height: 1.4;
      }
      
      #terminal {
        top: 5vh;
        left: 5vw;
        right: 5vw;
        max-width: 90vw; /* Take up more screen width on mobile */
        padding: 0 2vw;
      }
      
      input {
        width: 70vw; /* Wider input on mobile */
        font-size: 1.0rem;
      }
      
      .line {
        margin: 0.5vh 0; /* Tighter spacing on mobile */
        word-wrap: break-word;
        overflow-wrap: break-word;
      }
      
      /* Adjust font sizes for mobile */
      #boot, #prompt, #msg, input {
        font-size: 1.0rem !important;
      }
    }
    
    @media screen and (max-width: 480px) {
      body {
        font-size: 0.9rem; /* Even smaller for very small screens */
      }
      
      #terminal {
        top: 3vh;
        left: 3vw;
        right: 3vw;
        max-width: 94vw;
        padding: 0 1vw;
      }
      
      input {
        width: 80vw;
        font-size: 0.9rem;
      }
      
      #boot, #prompt, #msg, input {
        font-size: 0.9rem !important;
      }
      
      .line {
        margin: 0.3vh 0;
      }
    }
    
    /* LANDSCAPE MOBILE FIXES */
    @media screen and (max-height: 500px) and (orientation: landscape) {
      #terminal {
        top: 2vh;
        font-size: 0.8rem;
      }
      
      body {
        font-size: 0.8rem;
      }
      
      #boot, #prompt, #msg, input {
        font-size: 0.8rem !important;
      }
      
      .line {
        margin: 0.2vh 0;
      }
    }
  </style>
</head>
<body>
  <!-- Loading indicator shown during initial load -->
  <div id="loading-indicator">INITIALIZING</div>
  
  <div id="main-container" style="display: none;">
    <div id="terminal">
      <div id="boot"></div>
      <div class="line" id="prompt"></div>
      <input type="password" id="password" autofocus />
      <div class="line" id="msg"></div>
    </div>
  </div>

  <!-- Custom cursor -->
  <div id="custom-cursor"></div>

  <script src="script.js?v=6" defer></script>
  
  <script>
    // MOBILE-AWARE ZOOM SYSTEM
    function getBaseFontSize() {
      // Detect mobile and adjust base font size
      const isMobile = window.innerWidth <= 768;
      const isSmallMobile = window.innerWidth <= 480;
      const isLandscape = window.innerHeight <= 500 && window.innerWidth > window.innerHeight;
      
      if (isLandscape) return 0.8;
      if (isSmallMobile) return 0.9;
      if (isMobile) return 1.0;
      return 1.4; // Desktop default
    }
    
    let fontSize = getBaseFontSize();
    
    function zoomIn() {
      const maxSize = window.innerWidth <= 768 ? 1.8 : 2.5; // Lower max on mobile
      fontSize = Math.min(fontSize + 0.1, maxSize); // Smaller increments
      updateFontSize();
      console.log('Zoom IN:', fontSize + 'rem');
    }
    
    function zoomOut() {
      const minSize = window.innerWidth <= 768 ? 0.5 : 0.6; // Lower min on mobile
      fontSize = Math.max(fontSize - 0.1, minSize); // Smaller increments
      updateFontSize();
      console.log('Zoom OUT:', fontSize + 'rem');
    }
    
    function resetZoom() {
      fontSize = getBaseFontSize();
      updateFontSize();
      console.log('Zoom RESET:', fontSize + 'rem');
    }
    
    function updateFontSize() {
      const size = fontSize + 'rem';
      document.body.style.fontSize = size;
      
      // Update all text elements
      const elements = document.querySelectorAll('#boot, #prompt, #msg, input');
      elements.forEach(el => {
        if (el) el.style.fontSize = size;
      });
    }
    
    // Font cycling functionality - UPDATED WITH 6 FONTS - IBM3270 DEFAULT
    let currentFontIndex = 1; // Start with IBM3270 as default
    let currentFontSize = 1.0; // Size multiplier (1.0 = 100% of original size)
    const fonts = [
      { family: 'monospace', size: '1.4rem' },
      { family: 'IBM3270', size: '1.82rem' },  // 30% bigger than 1.4rem (1.4 * 1.3 = 1.82)
      { family: 'PixelCarnageMono', size: '1.4rem' },
      { family: 'Crisp', size: '1.4rem' },
      { family: 'ProggyCleanCE', size: '1.4rem' },
      { family: 'ProggySquare', size: '1.4rem' }
    ];
    
    // Lazy font loading system
    const lazyFonts = {
      'PixelCarnageMono': { loaded: false, url: 'fonts/fonts/PixelCarnageMono.ttf' },
      'Crisp': { loaded: false, url: 'fonts/fonts/Crisp.ttf' },
      'ProggyCleanCE': { loaded: false, url: 'fonts/fonts/ProggyCleanCE.ttf' },
      'ProggySquare': { loaded: false, url: 'fonts/fonts/ProggySquare.ttf' }
    };
    
    function loadFont(fontFamily) {
      if (lazyFonts[fontFamily] && !lazyFonts[fontFamily].loaded) {
        console.log('Loading font:', fontFamily);
        const fontFace = new FontFace(fontFamily, `url(${lazyFonts[fontFamily].url})`);
        
        fontFace.load().then((loadedFont) => {
          document.fonts.add(loadedFont);
          lazyFonts[fontFamily].loaded = true;
          console.log('Font loaded successfully:', fontFamily);
        }).catch((error) => {
          console.error('Failed to load font:', fontFamily, error);
        });
      }
    }
    
    // Font loading verification - now only checks loaded fonts
    function verifyFonts() {
      const availableFonts = [1]; // IBM3270 is always available (index 1)
      console.log('Available fonts at startup: IBM3270 (others load on demand)');
      return availableFonts;
    }
    
    function cycleFontForward() {
      console.log('Forward key pressed, current index:', currentFontIndex);
      currentFontIndex = (currentFontIndex + 1) % fonts.length;
      console.log('New index:', currentFontIndex);
      applyCurrentFont();
    }
    
    function cycleFontBackward() {
      console.log('Backward key pressed, current index:', currentFontIndex);
      currentFontIndex = (currentFontIndex - 1 + fonts.length) % fonts.length;
      console.log('New index:', currentFontIndex);
      applyCurrentFont();
    }
    
    function applyCurrentFont() {
      const selectedFont = fonts[currentFontIndex];
      console.log('Applying font:', selectedFont);
      
      try {
        // Load font if it's not a basic font and not already loaded
        if (selectedFont.family !== 'monospace' && selectedFont.family !== 'IBM3270') {
          loadFont(selectedFont.family);
        }
        
        // Update the CSS custom property
        document.documentElement.style.setProperty('--font-family', selectedFont.family);
        
        // Calculate the actual size with the current multiplier
        const baseSize = parseFloat(selectedFont.size);
        const actualSize = (baseSize * currentFontSize) + 'rem';
        
        // Apply the font family and size to all text elements
        const textElements = document.querySelectorAll('#boot, #prompt, #msg, input');
        textElements.forEach(el => {
          if (el) {
            el.style.fontFamily = selectedFont.family;
            el.style.fontSize = actualSize;
          }
        });
        
        // Also apply to body to ensure all elements inherit the font
        document.body.style.fontFamily = selectedFont.family;
        
        console.log(`Font changed to: ${selectedFont.family} at size ${actualSize} (multiplier: ${currentFontSize})`);
      } catch (error) {
        console.error('Error applying font:', error);
        // Fallback to monospace if there's an error
        document.documentElement.style.setProperty('--font-family', 'monospace');
        document.body.style.fontFamily = 'monospace';
      }
    }
    
    // Font size control functions
    function increaseFontSize() {
      currentFontSize = Math.min(currentFontSize + 0.1, 2.0); // Max 200%
      applyCurrentFont();
      console.log('Font size increased to:', (currentFontSize * 100).toFixed(0) + '%');
    }
    
    function decreaseFontSize() {
      currentFontSize = Math.max(currentFontSize - 0.1, 0.5); // Min 50%
      applyCurrentFont();
      console.log('Font size decreased to:', (currentFontSize * 100).toFixed(0) + '%');
    }
    
    function resetFontSize() {
      currentFontSize = 1.0; // Reset to 100%
      applyCurrentFont();
      console.log('Font size reset to 100%');
    }

    // Keyboard controls - match lorem.html functionality
    document.addEventListener('keydown', function(e) {
      if (e.key === '+' || e.key === '=') {
        e.preventDefault();
        increaseFontSize();
      } else if (e.key === '-') {
        e.preventDefault();
        decreaseFontSize();
      } else if (e.key === '0') {
        e.preventDefault();
        resetFontSize();
      } else if (e.key === 'f' || e.key === 'F') {
        e.preventDefault();
        toggleFullscreen();
      } else if (e.key === '1' || e.key === '2' || e.key === '3') {
        e.preventDefault();
        setColorScheme(parseInt(e.key) - 1);
      } else if (e.key === 'z' || e.key === 'Z') {
        e.preventDefault();
        toggleGlow('full');
      } else if (e.key === 'x' || e.key === 'X') {
        e.preventDefault();
        toggleGlow('half');
      } else if (e.key === 'c' || e.key === 'C') {
        e.preventDefault();
        toggleGlow('off');
      } else if (e.key === 'b' || e.key === 'B') {
        e.preventDefault();
        console.log('B key detected - cycling font backward');
        cycleFontBackward();
      } else if (e.key === 'n' || e.key === 'N') {
        e.preventDefault();
        console.log('N key detected - cycling font forward');
        cycleFontForward();
      }
    });
    
    // Fullscreen functionality
    function toggleFullscreen() {
      if (!document.fullscreenElement) {
        document.documentElement.requestFullscreen().catch(err => {
          console.log(`Error attempting to enable fullscreen: ${err.message}`);
        });
      } else {
        document.exitFullscreen();
      }
    }
    
    // Color scheme functionality - match lorem.html
    let colorIndex = 2; // Default to soft green (option 3)
    const colors = ['#CCCCCC', '#00FF00', '#66FF66'];
    
    function setColorScheme(index) {
      colorIndex = index;
      applyColors();
    }
    
    function applyColors() {
      const color = colors[colorIndex];
      // Update CSS custom properties
      document.documentElement.style.setProperty('--accent', color);
      document.documentElement.style.setProperty('--soft', color);
      
      const elements = document.querySelectorAll('#boot, #prompt, #msg, input');
      elements.forEach(el => {
        if (el) {
          el.style.color = color;
          if (glowMode === 'full') {
            el.style.textShadow = `0 0 2px ${color}, 0 0 12px ${color}`;
          } else if (glowMode === 'half') {
            el.style.textShadow = `0 0 1px ${color}, 0 0 6px ${color}`;
          } else {
            el.style.textShadow = 'none';
          }
        }
      });
    }
    
    // Glow toggle functionality  
    let glowMode = 'full';
    
    function toggleGlow(mode) {
      glowMode = mode;
      const color = colors[colorIndex];
      const elements = document.querySelectorAll('#boot, #prompt, #msg, input');
      
      elements.forEach(el => {
        if (!el) return;
        if (mode === 'full') {
          el.style.textShadow = `0 0 2px ${color}, 0 0 12px ${color}`;
        } else if (mode === 'half') {
          el.style.textShadow = `0 0 1px ${color}, 0 0 6px ${color}`;
        } else if (mode === 'off') {
          el.style.textShadow = 'none';
        }
      });
    }
    
    // ADDITIONAL SCROLL PREVENTION
    function preventScroll(e) {
      e.preventDefault();
      e.stopPropagation();
      return false;
    }
    
    // Block all scroll events
    document.addEventListener('wheel', preventScroll, { passive: false });
    document.addEventListener('touchmove', preventScroll, { passive: false });
    document.addEventListener('scroll', preventScroll, { passive: false });
    
    // console.log('Terminal interface initialized'); // Debug disabled
    // console.log('Controls: +/- font size, 0 reset size, F fullscreen, 1/2/3 colors, Z/X/C glow, B/N font cycle'); // Debug disabled
    
    // Custom cursor functionality - hide on mobile
    const customCursor = document.getElementById('custom-cursor');
    const isMobileDevice = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || window.innerWidth <= 768;
    
    if (!isMobileDevice) {
      document.addEventListener('mousemove', (e) => {
        customCursor.style.left = e.clientX + 'px';
        customCursor.style.top = e.clientY + 'px';
        customCursor.style.display = 'block';
      });
      
      document.addEventListener('mouseleave', () => {
        customCursor.style.display = 'none';
      });
    } else {
      // Hide custom cursor on mobile and restore default cursor
      customCursor.style.display = 'none';
      document.body.style.cursor = 'auto';
      
      // Add touch support for mobile input focus
      document.addEventListener('touchstart', (e) => {
        if (elements.passwordInput && e.target !== elements.passwordInput) {
          elements.passwordInput.focus();
        }
      });
    }
    
    // Handle window resize and orientation changes for mobile
    function handleResize() {
      // Recalculate base font size for new screen dimensions
      const newBaseFontSize = getBaseFontSize();
      fontSize = newBaseFontSize;
      updateFontSize();
      applyCurrentFont();
      console.log('Screen resized, font size adjusted to:', fontSize);
    }
    
    // Add resize event listener with debouncing
    let resizeTimeout;
    window.addEventListener('resize', () => {
      clearTimeout(resizeTimeout);
      resizeTimeout = setTimeout(handleResize, 250);
    });
    
    // Fast initialization function
    function initializeApp() {
      // Show main content and hide loading indicator
      const loadingIndicator = document.getElementById('loading-indicator');
      const mainContainer = document.getElementById('main-container');
      const loadingStyles = document.getElementById('loading-styles');
      
      if (loadingIndicator) loadingIndicator.style.display = 'none';
      if (mainContainer) mainContainer.style.display = 'block';
      if (loadingStyles) loadingStyles.remove(); // Remove loading styles to save memory
      
      // Initialize color scheme, font size, and default font
      applyColors();
      updateFontSize();
      applyCurrentFont(); // Set IBM3270 as default font
      
      // console.log('🚀 App initialized - loading indicator removed'); // Debug disabled
    }
    
    // Initialize immediately when script runs
    initializeApp();
    
    // Test function - you can call this in console to test font cycling
    window.testFontCycle = function() {
      console.log('Testing font cycle...');
      console.log('Available fonts:', fonts);
      console.log('Current font index:', currentFontIndex);
      console.log('Current font:', fonts[currentFontIndex]);
      console.log('Fonts array length:', fonts.length);
    };
    
    // Test font cycling manually
    window.testFontChange = function() {
      console.log('Testing font change...');
      cycleFontForward();
    };
    
    // Log initial state
    console.log('Fonts loaded:', fonts.length);
    console.log('Font names:', fonts.map(f => f.family));
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Unscramble + Images</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    /* Background video - simple full screen background */
    .bg-video {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      object-fit: cover;
      z-index: 100000;
      display: none;
      filter: hue-rotate(15deg) saturate(1.1);
    }
    
    /* Mobile video - same simple approach */
    @media (max-width: 768px) {
      .bg-video {
        object-fit: cover;
      }
    }
    
    /* Hologram overlay removed */
    
    /* Video effects removed - clean video display */
    
    
    
    /* Video overlay (disabled for small centered video) */
    .bg-overlay {
      display: none;
    }
    
    #bg-overlay {
      display: none;
    }
    /* Your actual content goes above (z-index > 0) */
    .content {
      position: relative;
      z-index: 1;
      color: #e8e8e8;
      font: 16px/1.5 system-ui, sans-serif;
      padding: 6vmin;
    }
    html,body { height:100%; margin:0; background:#000; }

    /* Font Definition - Crisp Only */
    @font-face {
      font-family: 'Crisp';
      src: url('fonts/fonts/Crisp.ttf') format('truetype');
      font-weight: normal;
      font-style: normal;
      font-display: swap;
    }
    
    :root { 
      --fg:#00FF00; 
      --bg:#000; 
      --accent:#00FF00; 
      --soft:#66FF66;
      --font-family: 'Crisp', 'Courier New', monospace;
    }
    html, body { height:100%; }
    
    /* FORCE NO SCROLLING */
    html {
      overflow: hidden;
      height: 100%;
      width: 100%;
    }
    
    body {
      overflow: hidden;
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background:var(--bg); 
      color:var(--fg); 
      font-family:var(--font-family);
      padding: 0;
      perspective: 1000px; 
      margin: 0;
      line-height:1.6; 
      -webkit-user-select: none;
      user-select: none;
      font-size: 1rem;
      box-sizing: border-box;
    }
    
    /* CRT scanline effect */
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: repeating-linear-gradient(
0deg,
transparent 0px,
transparent 2px,
rgba(0, 255, 0, 0.03) 2px,
rgba(0, 255, 0, 0.03) 4px
      );
      pointer-events: none;
      z-index: 99998;
    }
    
    /* Black scanlines on top */
    body::after {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: repeating-linear-gradient(
0deg,
rgba(0, 0, 0, 0.26) 0px,
rgba(0, 0, 0, 0.26) 2px,
transparent 2px,
transparent 4px
      );
      pointer-events: none;
      z-index: 99999;
    }
    
    @media (max-width: 768px) {
      body {
        padding: 0 !important;
        margin: 0 !important;
        font-size: 0.85rem;
        padding-left: 0 !important;
        max-width: 100% !important;
        width: 100% !important;
        left: 0 !important;
        right: 0 !important;
        overflow-x: hidden !important;
        -webkit-text-size-adjust: 100%; /* Prevent iOS text scaling */
        text-size-adjust: 100%; /* Standard property for Chrome/Edge */
        -webkit-tap-highlight-color: transparent; /* Remove tap highlights */
      }
      #page {
        padding: 1vh 3vw; /* Slightly more padding for better readability */
        height: 75vh; /* Better height for mobile */
        min-height: 30em;
        width: 100% !important;
        max-width: 100% !important;
        margin: 0 !important;
        left: 0 !important;
        right: 0 !important;
        box-sizing: border-box !important;
        overflow-x: hidden !important;
      }
      #text-wrap {
        width: 100% !important; /* Force full width on mobile */
        max-width: 100% !important;
        margin-top: 0; /* Remove negative margin that was causing issues */
        height: calc(100% - 2rem); /* Better height calculation */
        padding: 1.5rem 2vw !important; /* Better padding for mobile */
        box-sizing: border-box !important;
        overflow-x: hidden !important;
        position: relative !important;
        z-index: 9999999 !important;
      }
      
      #unscramble {
        font-size: 0.85rem; /* Slightly larger for better readability */
        line-height: 1.4; /* Better line spacing */
        width: 100% !important; /* Force full width */
        max-width: 100% !important;
        padding: 0 !important;
        margin: 0 !important;
        box-sizing: border-box !important;
        word-wrap: break-word !important;
        overflow-wrap: break-word !important;
        white-space: pre-wrap !important;
        overflow-x: hidden !important;
        word-break: break-word !important; /* Force word breaking on mobile */
        -ms-hyphens: auto; /* IE hyphenation */
        -webkit-hyphens: auto; /* Safari hyphenation */
        hyphens: auto !important; /* Enable hyphenation on mobile */
      }
      #nav {
        font-size: 1rem; /* Larger for better touch targets */
        margin: 0.5vh 0;
        padding: 0.5rem 0; /* Better touch area */
      }
      #nav span {
        padding: 0.5rem 1rem; /* Larger touch targets */
        min-height: 44px; /* iOS recommended touch target size */
        display: inline-flex;
        align-items: center;
        justify-content: center;
      }
      #nav-msg {
        font-size: 0.7rem; /* Slightly larger */
        line-height: 1.2;
        padding: 0.5rem;
      }
      /* Slide counter mobile styles handled in main styles */
      #prompt {
        font-size: 0.75rem; /* Slightly larger */
        line-height: 1.3;
      }
      
      /* Mobile video sizing removed - handled in main mobile styles */
      
      /* Force full width on mobile regardless of image mode */
      #text-wrap.side-mode,
      #text-wrap.small-side-mode {
        width: 100% !important;
        max-width: 100% !important;
        position: relative !important;
        z-index: 2 !important;
        padding: 1rem 1vw !important; /* Reduced padding to match main text-wrap */
        box-sizing: border-box !important;
        overflow-x: hidden !important;
      }
      
      #text-wrap.side-mode #unscramble,
      #text-wrap.small-side-mode #unscramble {
        width: 100% !important;
        max-width: 100% !important;
        padding: 0 !important;
        margin: 0 !important;
        box-sizing: border-box !important;
        word-wrap: break-word !important;
        overflow-wrap: break-word !important;
        white-space: pre-wrap !important;
        overflow-x: hidden !important;
        word-break: break-word !important; /* Force word breaking on mobile */
        hyphens: auto !important; /* Enable hyphenation on mobile */
      }
      
      /* Additional mobile constraints to prevent overflow */
      * {
        max-width: 100% !important;
        box-sizing: border-box !important;
      }
      
      /* Ensure no element can cause horizontal overflow */
      html, body, #page, #text-wrap, #unscramble {
        overflow-x: hidden !important;
        max-width: 100vw !important;
      }
      
      /* First slide mobile - bigger text */
      #page[data-page="1"] #unscramble {
        font-size: 1.1em !important;
        line-height: 1.3 !important;
      }
      
      
      /* Better mobile navigation */
      #nav {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        background: rgba(0, 0, 0, 0.8);
        -webkit-backdrop-filter: blur(10px);
        backdrop-filter: blur(10px);
        z-index: 1000;
        padding: 0.75rem 0;
      }
      
      /* Mobile slide counter positioning */
      #slide-counter {
        position: fixed;
        bottom: 4rem;
        left: 50%;
        transform: translateX(-50%);
        font-size: 0.9rem;
        background: rgba(0, 0, 0, 0.7);
        padding: 0.5rem 1rem;
        border-radius: 4px;
        z-index: 1000;
      }
      
      /* Mobile nav message improvements */
      #nav-msg {
        background: rgba(0, 0, 0, 0.8);
        padding: 0.75rem;
        border-radius: 8px;
        margin: 0 1rem;
        text-align: center;
        -webkit-backdrop-filter: blur(10px);
        backdrop-filter: blur(10px);
      }
    }
    
    @media screen and (min-resolution: 1dppx) {
            body {
        font-size: 1.0rem;
      }
    }
    #page {
      position:relative; 
      height: 60vh;
      min-height: 20em; 
      padding:2rem; 
      border-radius:10px;
      background-size:cover; 
      background-position:center; 
      background-repeat:no-repeat;
      overflow: visible; /* Allow text to be visible */
    }
    
 /* Simple image display */
     #page img {
       display: none;
       filter: grayscale(1) brightness(0.64) contrast(1.2) sepia(1) hue-rotate(60deg) saturate(2);
       /* Grayscale + green tint: black stays black, white becomes green */
       /* Ensure all image formats including GIFs display properly */
       image-rendering: auto;
     }
     
   /* Special rule: dim only photo7 - REMOVED (was too dark) */
      
      /* Special rule: dim only photo23 */
      #page img[id="img-23"] {
filter: grayscale(1) brightness(0.32) contrast(1.2) sepia(1) hue-rotate(60deg) saturate(2);
      }
      
      /* Special rule: make page 10 images darker */
      #page img[id^="img-10"] {
filter: grayscale(1) brightness(0.35) contrast(1.2) sepia(1) hue-rotate(60deg) saturate(2);
      }
    
    #page img.show-bg {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      z-index: -1;
      display: block;
    }
    
 #page img.show-below {
       display: block;
       margin-top: 1rem;
       max-height: 40%;
       max-width: 100%;
       object-fit: contain;
       position: relative;
       top: -12rem;
       z-index: -1;
     }
    
     #page img.show-side {
display: block;
position: absolute;
right: 0;
top: 0;
width: 50%;
height: 100%;
object-fit: cover;
z-index: 1;
      }
      
     #page img.show-small-side {
 display: block;
 position: absolute;
 right: 0;
 top: 0;
 width: 25%;
 height: 60%;
 object-fit: cover;
 z-index: 1;
       }
    
    /* Text container width is now controlled by JavaScript */
    
    /* Hide the default cursor */
    body {
      cursor: none;
    }
    
    /* Custom cursor element */
    #custom-cursor {
      position: fixed;
      width: 10px;
      height: 10px;
      background: var(--accent);
      border-radius: 50%;
      pointer-events: none;
      z-index: 10000;
      mix-blend-mode: difference;
      display: none;
    }
    
    /* Hide cursor on mobile */
    @media (max-width: 768px) {
      #custom-cursor {
        display: none !important;
      }
    }

    /* Year styling - make years and year ranges larger */
    .year-text {
      font-size: 1.2em !important;
      font-weight: bold;
      color: #00FF00;
      text-shadow: 0 0 2px #00FF00, 0 0 12px #00FF00;
    }
    
    /* Ensure text content appears above video and photos */
    @media (min-width: 769px) {
      #text-wrap, #unscramble, #page {
        position: relative;
        z-index: 9999999 !important;
      }
    }
    
    /* First slide text - bigger */
    #page[data-page="1"] #unscramble {
      font-size: 1.2em !important;
      line-height: 1.4 !important;
    }
    
    /* Slide 2 and 3 text 10% bigger */
    #page[data-page="2"] #unscramble,
    #page[data-page="3"] #unscramble {
      font-size: 1.1em !important;
    }
    
    
    
    /* Video loading status */
    #video-loading {
      position: fixed;
      top: calc(100vh - 8rem);
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 10001;
      text-align: center;
      pointer-events: none;
    }
    
    .loading-text {
      font-family: var(--font-family);
      font-size: 1.2rem;
      color: var(--soft);
      text-shadow: 0 0 2px var(--soft), 0 0 12px var(--soft);
      margin-bottom: 1.5rem;
      letter-spacing: 0.1em;
      text-transform: uppercase;
    }
    
    .loading-bar {
      width: 300px;
      height: 4px;
      background: rgba(102, 255, 102, 0.2);
      border: 1px solid var(--soft);
      border-radius: 2px;
      overflow: hidden;
      position: relative;
    }
    
    .loading-progress {
      height: 100%;
      background: var(--soft);
      box-shadow: 0 0 4px var(--soft);
      width: 0%;
      transition: width 0.3s ease;
      animation: loadingPulse 1.5s ease-in-out infinite;
    }
    
    @keyframes loadingPulse {
      0%, 100% { 
        opacity: 0.6;
        box-shadow: 0 0 4px var(--soft);
      }
      50% { 
        opacity: 1;
        box-shadow: 0 0 8px var(--soft), 0 0 16px var(--soft);
      }
    }
    
    /* Mobile loading status */
    @media (max-width: 768px) {
      .loading-text {
        font-size: 1rem;
      }
      .loading-bar {
        width: 250px;
        height: 3px;
      }
    }
    
 #text-wrap { 
       position: fixed;
       top: 0;
       left: 0;
       width: 100vw;
       height: 100vh;
       box-sizing: border-box;
       overflow: hidden;
       max-width: 100vw;
       padding: 4rem 2rem 6rem 4rem; /* Consistent top padding for all slides */
       z-index: 9999999;
     }
     
    /* Mobile-specific text-wrap overrides */
    @media (max-width: 768px) {
      #text-wrap {
        margin-top: 0; /* Remove negative margin on mobile */
        height: calc(100% - 1rem); /* Better height calculation for mobile */
        padding: 1vh 2vw; /* Reduced horizontal padding */
        height: 70vh; /* Increased height for mobile */
        min-height: 25em;
        width: 100% !important;
        max-width: 100% !important;
        margin: 0 !important;
        left: 0 !important;
        right: 0 !important;
        box-sizing: border-box !important;
        overflow-x: hidden !important;
      }
    }
                    #unscramble { 
      white-space: pre-wrap; 
      font-size: 0.99rem;
      line-height: 1.5;
      word-wrap: break-word;
      overflow-wrap: break-word;
      height: 100%;
      overflow: hidden;
      width: 100%;
      box-sizing: border-box;
      max-width: 100%;
      /* Preserve original formatting - no text wrapping modifications */
      text-indent: 0;
      word-break: normal;
      hyphens: none;
    }
    
     
     /* Handle indented line wrapping - preserve indentation for continuation lines */
     #unscramble .indented-line {
       display: block;
       text-indent: 2em; /* Standard indentation */
     }
     
     #unscramble .continuation {
       display: block;
       text-indent: 2em; /* Same indentation as parent */
     }
    #prompt { 
      margin-top:1rem; 
      visibility:hidden; 
      white-space:pre-wrap; 
      line-height:1.3; 
      font-size: 0.9rem;
    }

    #nav { 
      display: flex;
      justify-content: center;
      align-items: center;
      margin: 0; 
      font-size: 0.9rem;
      min-height: 7vh;
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: rgba(0, 0, 0, 0.8);
      -webkit-backdrop-filter: blur(10px);
      backdrop-filter: blur(10px);
      z-index: 1000;
      padding: 0.75rem 0;
      gap: 2vw;
    }
    
    /* Desktop - add padding to bring arrows in from edges */
    @media (min-width: 769px) {
      #nav {
        padding: 0.75rem 4rem;
      }
    }
    #nav span { cursor:pointer; -webkit-user-select: none; user-select: none; padding:0 1em; }
          #nav-msg { 
      flex-grow:1; 
      text-align:center; 
      font-size:0.6rem;
      min-height: 1.5rem;
      visibility: hidden;
    }
    
    #slide-counter {
      position: fixed;
      bottom: 5rem;
      left: 50%;
      transform: translateX(-50%);
      font-size: 1rem;
      opacity: 1;
      color: var(--accent);
      text-shadow: 0 0 2px var(--accent), 0 0 12px var(--accent);
      font-family: var(--font-family);
      pointer-events: none;
      z-index: 1000;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      text-align: center;
      margin: 0;
      background: rgba(0, 0, 0, 0.7);
      padding: 0.5rem 1rem;
      border-radius: 4px;
    }
    
   /* Side mode: text on left, image on right */
      #text-wrap.side-mode {
width: 50% !important;
max-width: 50% !important;
position: relative !important;
z-index: 2 !important;
      }
      
     /* Small side mode: text on left, smaller image on right */
       #text-wrap.small-side-mode {
 width: 75% !important;
 max-width: 75% !important;
 position: relative !important;
 z-index: 2 !important;
       }
    
  #text-wrap.side-mode #unscramble {
      width: 100% !important;
      max-width: 100% !important;
      overflow: hidden !important;
      white-space: pre-wrap !important;
      word-wrap: normal !important;
      overflow-wrap: normal !important;
      hyphens: none !important;
      text-indent: 0 !important;
      padding-left: 2rem !important;
      padding-right: 2rem !important;
    }
    
    #text-wrap.small-side-mode #unscramble {
      width: 100% !important;
      max-width: 100% !important;
      overflow: hidden !important;
      white-space: pre-wrap !important;
      word-wrap: normal !important;
      overflow-wrap: normal !important;
      hyphens: none !important;
      text-indent: 0 !important;
      font-size: 1.0rem !important;
      line-height: 1.3 !important;
      padding-left: 2rem !important;
      padding-right: 2rem !important;
    }
    
    
    /* Collateral Murder animation removed - no more scrolling */
    
    /* Ensure all unscramble elements have consistent padding */
    #unscramble {
      padding-left: 2rem !important;
      padding-right: 2rem !important;
      padding-top: 0 !important; /* No top padding - container handles it */
    }
    
    /* Add top padding specifically for slide 5 */
    #page[data-page="5"] #unscramble {
      padding-top: 1rem !important;
    }
    
    /* Add top padding specifically for slide 6 */
    #page[data-page="6"] #unscramble {
      padding-top: 1rem !important;
    }
    
    /* Add top padding for slides 2 and 3 */
    #page[data-page="2"] #unscramble,
    #page[data-page="3"] #unscramble {
      padding-top: 1rem !important;
    }
    
    /* Add top padding specifically for slide 4 */
    #page[data-page="4"] #unscramble {
      padding-top: 1rem !important;
    }
    
    /* Scanline movement animation */
    @keyframes scanlineMove {
      0% {
        transform: translateY(-100vh);
      }
      100% {
        transform: translateY(100vh);
      }
    }
    
    /* Mobile styles for last slide image */
    @media (max-width: 768px) {
      #last-slide-image-container {
        max-width: 85vw !important;
        max-height: 75vh !important;
        width: 85vw !important;
        height: 75vh !important;
        min-width: 80vw !important;
        min-height: 70vh !important;
        transform: translate(-50%, -60%) !important;
      }
      #last-slide-image {
        width: 100% !important;
        height: 100% !important;
        object-fit: contain !important;
      }
    }
    
    /* Common utility classes for better CSS organization */
    .full-screen-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100vh;
      z-index: 1000;
      pointer-events: none;
    }
    
    .centered-content {
      display: flex;
      align-items: flex-start;
      justify-content: center;
      padding-top: 2rem;
    }
    
    .accent-text {
      color: var(--accent);
      font-family: var(--font-family);
      text-shadow: 0 0 10px var(--accent);
    }
    
    /* Persistent text that stays on screen */
    #persistent-text {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100vh;
      z-index: 1000;
      pointer-events: none;
      display: flex;
      align-items: flex-start;
      justify-content: center;
      padding-top: 2rem;
    }
    
    #persistent-text .text-content {
      color: var(--accent);
      font-family: var(--font-family);
      text-shadow: 0 0 10px var(--accent);
      font-size: 2rem;
      text-align: center;
      font-weight: bold;
    }
    
     

  </style>
</head>
<body>

  <!-- video2 removed - defunct -->

  <video
    id="bg-video3"
    class="bg-video bg-video3"
    playsinline
    preload="metadata"
    aria-hidden="true"
    tabindex="-1"
    disablepictureinpicture
    controlslist="nodownload noplaybackrate noptimizequality nodatachannel"
  >
     <source src="VIDEOS/MAKEITSTOPAGHGH.mp4" type="video/mp4" />
  </video>
  
  <!-- OBIWAN_REAL audio removed - defunct -->

  <div class="bg-overlay" id="bg-overlay"></div>

  <div id="page">
    <div id="text-wrap">
      <div id="unscramble"></div>
      <div id="prompt"></div>
    </div>
    
    <!-- Images will be added here dynamically -->
  </div>

  <div id="nav">
    <span id="nav-prev">&lt;</span>
    <span id="nav-msg"></span>
    <span id="nav-next">&gt;</span>
  </div>

  <div id="slide-counter">SLIDE 1 / 1</div>

  
  <!-- Custom cursor -->
  <div id="custom-cursor"></div>

  <script>
    /* ================== CONTENT ================== */
    const fullTextRaw = `
RECIPIENT: DORSEY.6BDM180925

EYES ONLY / NO FWD / 
NO DSTRO

SOURCE: CSF
FILE ID: 369-108-11







THE SIX BILLION DOLLAR
MAN


PRESS [F] FOR FULL SCREEN





A FILM BY EUGENE JARECKI

 
 
 
 
              
 
      
 
         
 
 
 
     


6BDM: JULIAN ASSANGE AND THE PRICE OF TRUTH




2006: JULIAN ASSANGE BUILDS WIKILEAKS TO ENABLE WHISTLEBLOWERS TO INFORM THE PUBLIC.

2010: WIKILEAKS RELEASES LARGEST TROVE OF U.S. MILITARY SECRETS IN HISTORY, EXPOSING U.S. WAR CRIMES.

2012-2019: U.S. AUTHORITIES CHARGE ASSANGE WITH ESPIONAGE. HE TAKES ASYLUM IN ECUADORIAN EMBASSY, LONDON.




2019: ASSANGE IS IMPRISONED IN THE UK FOR FIVE YEARS. AWAITS EXTRADITION TO THE U.S TO FACE A FURTHER 175.

2024: U.S. SUDDENLY DROPS 17 OF ITS 18 COUNTS AGAINST ASSANGE, DISMISSES CASE. ASSANGE PLEADS GUILTY ONLY TO JOURNALISM AND RETURNS TO AUSTRALIA A FREE MAN.





IN 2025, THE SIX BILLION DOLLAR MAN WON THE CANNES FILM FESTIVAL AND THE FIRST-EVER GOLDEN GLOBE FOR DOCUMENTARY. BUT NO LEGACY MEDIA WILL TOUCH IT.
 
SO, LIKE WIKILEAKS, WE ARE TAKING THE FILM DIRECT TO THE PUBLIC. 

FOR THIS, WE NEED YOUR HELP. 






[TRAILER]


`;

    /* ================== AUDIO SYSTEM ================== */
    let audioContext = null;
    let audioEnabled = true; // Enable audio by default
    let debugMode = true;
    let currentAudio = null; // Track currently playing audio
    let audioVolume = 0.27; // Default volume level (60% quieter)
    
    // Function to stop any currently playing audio
    function stopCurrentAudio() {
      if (currentAudio) {
        console.log('🛑 Stopping current audio...');
        currentAudio.pause();
        currentAudio.currentTime = 0;
        currentAudio.src = ''; // Clear the source
        currentAudio.load(); // Reset the audio element
        currentAudio = null;
      }
      
      
      // Also stop any other audio elements that might be playing
      const allAudioElements = document.querySelectorAll('audio');
      allAudioElements.forEach(audio => {
        if (!audio.paused) {
          audio.pause();
          audio.currentTime = 0;
        }
      });
    }
    
    
    
    
    


    // Test audio function removed - defunct

    // Video preloading system
    const videoPreloadState = {
      'bg-video3': false
    };

    function preloadVideo(videoId) {
      const video = document.getElementById(videoId);
      if (!video || videoPreloadState[videoId]) return;
      
      console.log(`🎬 Preloading ${videoId}...`);
      video.preload = 'metadata';
      video.load();
      
      video.addEventListener('canplay', () => {
        console.log(`✅ ${videoId} preloaded successfully`);
        videoPreloadState[videoId] = true;
        video.removeEventListener('canplay', arguments.callee);
      }, { once: true });
    }



    // Video2 functions removed - defunct

    // Unlock audio context on user interaction
    function unlockAudioContext() {
      if (!audioContextUnlocked) {
        console.log('🔓 Unlocking audio context...');
        
        // Enable audio if not already enabled
        if (!audioEnabled) {
          audioEnabled = true;
          console.log('🔊 Audio enabled on first interaction');
        }
        
        // Initialize audio context first
        initAudioContext();
        
        // OBIWAN audio removed - use Web Audio API only
            if (audioContext && audioContext.state === 'suspended') {
              audioContext.resume().then(() => {
                audioContextUnlocked = true;
                console.log('✅ Audio context unlocked via resume');
              }).catch(resumeErr => {
                console.log('❌ Audio context resume failed:', resumeErr.message);
              });
        }
      }
    }


    // Video3 functions - with audio that stops when slide changes
    function showVideo3Background() {
      const video = document.getElementById('bg-video3');
      
      if (video) {
        console.log('🎬 showVideo3Background called - showing holofreeze video');
        
        // Show video as background
        video.style.display = 'block';
        
        // Debug video source
        console.log('🎬 Video src:', video.querySelector('source')?.src);
        console.log('🎬 Video current src:', video.currentSrc);
        console.log('🎬 Video ready state:', video.readyState);
        console.log('🎬 Video network state:', video.networkState);
        console.log('🎬 Video duration:', video.duration);
        console.log('🎬 Video paused:', video.paused);
        
        // Set video properties
        video.muted = false; // Don't start muted
        video.volume = 0.27; // 60% quieter
        video.loop = false; // Don't loop - freeze on last frame
        
        // Debug audio properties
        console.log('🔊 Video muted:', video.muted);
        console.log('🔊 Video volume:', video.volume);
        console.log('🔊 Video defaultMuted:', video.defaultMuted);
        
        // Unlock audio context first
        unlockAudioContext();
        
        // Set up video event listeners
        const onCanPlay = () => {
          console.log('✅ Video3 ready to play');
          video.currentTime = 1; // Skip the first second of video
          console.log('🎬 Video currentTime set to 1 second (skipping first second)');
          video.removeEventListener('canplay', onCanPlay);
          video.removeEventListener('error', onError);
        };
        
        const onError = (e) => {
          console.log('❌ Video3 failed to load:', e);
          console.log('❌ Video error code:', video.error ? video.error.code : 'unknown');
          console.log('❌ Video error message:', video.error ? video.error.message : 'unknown');
          console.log('❌ Video network state:', video.networkState);
          console.log('❌ Video ready state:', video.readyState);
          video.removeEventListener('canplay', onCanPlay);
          video.removeEventListener('error', onError);
        };
        
        const onEnded = () => {
          console.log('🎬 Video3 ended - freezing on last frame');
          // Video will automatically freeze on the last frame when ended
        };
        
        video.addEventListener('canplay', onCanPlay);
        video.addEventListener('error', onError);
        video.addEventListener('ended', onEnded);
        video.addEventListener('loadstart', () => {
          console.log('🔄 Video load started');
        });
        video.addEventListener('loadeddata', () => {
          console.log('📊 Video data loaded');
          console.log('🔊 Video audio tracks:', video.audioTracks ? video.audioTracks.length : 'not supported');
          console.log('🔊 Video has audio:', !video.muted && video.volume > 0);
        });
        
        // Try to play video with audio after a small delay to avoid pause conflicts
        console.log('🔊 Attempting to play video with audio...');
        console.log('🔊 Video element:', video);
        console.log('🔊 Video source element:', video.querySelector('source'));
        
        setTimeout(() => {
          video.play().then(() => {
            console.log('✅ Video3 playing with audio successfully');
            console.log('✅ Video current time:', video.currentTime);
            console.log('✅ Video duration:', video.duration);
            console.log('✅ Video muted after play:', video.muted);
            videoStartTime = Date.now(); // Track when video started playing
            console.log('🎬 Video start time recorded:', videoStartTime);
          }).catch(err => {
            console.log('❌ Video3 play failed:', err.message);
            console.log('❌ Error details:', err);
            console.log('🔧 This might require user interaction first');
            
            // Try again after a short delay
            setTimeout(() => {
              console.log('🔄 Retrying video play...');
              video.play().then(() => {
                console.log('✅ Video3 playing with audio on retry');
                videoStartTime = Date.now(); // Track when video started playing on retry
                console.log('🎬 Video start time recorded on retry:', videoStartTime);
              }).catch(retryErr => {
                console.log('❌ Video3 retry failed:', retryErr.message);
                console.log('❌ Retry error details:', retryErr);
              });
            }, 1000);
          });
        }, 100); // Small delay to avoid pause conflicts
        
        // Ensure audio is enabled after video loads
        video.addEventListener('loadeddata', () => {
          console.log('🔊 Video loaded - ensuring audio is enabled');
          video.muted = false;
          video.volume = 0.27; // 60% quieter
          console.log('🔊 Video muted after load:', video.muted);
          console.log('🔊 Video volume after load:', video.volume);
        });
      }
    }

    function hideVideo3Background() {
      const video = document.getElementById('bg-video3');
      
      if (video) {
        video.pause();
        video.style.display = 'none';
      }
      
    }
    
    // Enhanced audio context initialization with debugging
    function initAudioContext() {
      if (debugMode) console.log('🔊 Initializing audio context...');
      
      if (!audioContext) {
        try {
          audioContext = new (window.AudioContext || window.webkitAudioContext)();
          console.log('✅ Audio context created successfully:', audioContext.state);
          
          // Resume audio context if suspended (required by Chrome)
          if (audioContext.state === 'suspended') {
            audioContext.resume().then(() => {
              console.log('✅ Audio context resumed from suspended state');
            }).catch(err => {
              console.error('❌ Failed to resume audio context:', err);
            });
          }
        } catch (e) {
          console.error('❌ Audio context creation failed:', e);
          audioEnabled = false;
          showAudioError('Audio not supported in this browser');
        }
      }
      return audioContext !== null;
    }
    
    // Show audio error in the UI
    function showAudioError(message) {
      const navMsg = document.getElementById('nav-msg');
      if (navMsg) {
        const originalText = navMsg.textContent;
        const originalVisibility = navMsg.style.visibility;
        
        navMsg.textContent = `AUDIO ERROR: ${message}`;
        navMsg.style.visibility = 'visible';
        navMsg.style.color = '#FF6666';
        
        setTimeout(() => {
          navMsg.textContent = originalText;
          navMsg.style.visibility = originalVisibility;
          navMsg.style.color = '';
        }, 3000);
      }
    }
    
    
    
    
    


    // Audio functions for pages 8 and 12 removed - defunct

    /* ================== PREP ================== */
    const fullText = fullTextRaw.toUpperCase();
    const pages = fullText.split(/\n{4,}/).filter(page => page.trim().length > 0);
    console.log('📄 Page 2 content:', pages[1] ? pages[1].substring(0, 100) : 'UNDEFINED');
    console.log('📄 Total pages created:', pages.length);
    console.log('📄 Pages:', pages.map((p, i) => `Page ${i + 1}: ${p.substring(0, 50)}...`));
    
    // Debug: Show detailed content for each page
    pages.forEach((page, index) => {
      console.log(`📄 DETAILED Page ${index + 1} (${page.length} chars):`, page.substring(0, 200));
      if (page.includes('IN 2025, THE SIX BILLION DOLLAR MAN')) {
        console.log(`🎯 FOUND "IN 2025" content on page ${index + 1}`);
      }
    });
    const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789 .,\'"?!-—:;\n';

    // Image mode constants and functions removed - no more image mode switching
    
    // Image mode functions removed - no more image mode switching
    
    // pageModes array removed - no more image mode switching
    
    
    // Image mode loading removed
    
    // Keyword scanning removed - no more image searches
    
    // Test audio functions removed - defunct
    
    

    // DOM
    const pageEl = document.getElementById('page');
    const textWrap = document.getElementById('text-wrap');
    const el = document.getElementById('unscramble');
    const promptElem = document.getElementById('prompt');
    const navMsg = document.getElementById('nav-msg');
    const slideCounterEl = document.getElementById('slide-counter');

    let currentPage = 0;
    let isAnimating = false;
    let currentInterval = null;
    let currentAnimationFrame = null;
    // availableKeywords removed - no more keyword searches
    let audioTimeout = null; // Track audio timeout
    let lineRevealTimeouts = []; // Track line reveal timeouts
    let isInLineRevealMode = false;
    let lineRevealState = { lines: [], currentIndex: 0, element: null, onComplete: null };
    let lastTouchTime = 0; // Track last touch time to prevent double-firing
    let filmByTimeouts = []; // Track 6BDM animation timeouts
    let currentTypingInterval = null; // Track the current subtitle typing interval
    let shouldContinueTyping = true; // Flag to control if typing should continue
    let audioContextUnlocked = false; // Track if audio context is unlocked
    let scramblingDisabled = false; // Track if scrambling should be disabled
    let videoStartTime = null; // Track when video started playing
    
    
    // Memory management
    let activeEventListeners = new Map(); // Track active event listeners
    let createdElements = new Set(); // Track created DOM elements
    
    // Memory management functions
    function addEventTracker(element, event, handler) {
      const key = `${element.id || element.tagName}-${event}`;
      if (!activeEventListeners.has(key)) {
        activeEventListeners.set(key, []);
      }
      activeEventListeners.get(key).push({ element, event, handler });
      element.addEventListener(event, handler);
    }
    
    function removeEventTracker(element, event, handler) {
      const key = `${element.id || element.tagName}-${event}`;
      if (activeEventListeners.has(key)) {
        const listeners = activeEventListeners.get(key);
        const index = listeners.findIndex(l => l.element === element && l.handler === handler);
        if (index > -1) {
          listeners.splice(index, 1);
          element.removeEventListener(event, handler);
          if (listeners.length === 0) {
            activeEventListeners.delete(key);
          }
        }
      }
    }
    
    function cleanupElement(element) {
      if (!element) return;
      
      // Remove all tracked event listeners
      const elementId = element.id || element.tagName;
      for (const [key, listeners] of activeEventListeners.entries()) {
        if (key.startsWith(elementId)) {
          listeners.forEach(({ element: el, event, handler }) => {
            if (el === element) {
              el.removeEventListener(event, handler);
            }
          });
          activeEventListeners.delete(key);
        }
      }
      
      // Remove from created elements set
      createdElements.delete(element);
      
      // Remove from DOM
      if (element.parentNode) {
        element.parentNode.removeChild(element);
      }
    }
    
    function cleanupUnusedElements() {
      // Clean up images that are not for current or next page
      const currentPageNumber = currentPage + 1;
      const nextPageNumber = currentPage + 2;
      
      document.querySelectorAll('#page img').forEach(img => {
        const imgId = img.id;
        if (imgId) {
          const pageNumber = parseInt(imgId.replace('img-', ''));
          if (pageNumber < currentPageNumber - 1 || pageNumber > nextPageNumber) {
            console.log(`🧹 Cleaning up unused image for page ${pageNumber}`);
            cleanupElement(img);
          }
        }
      });
      
      // Clean up old persistent text elements
      const oldPersistentText = document.getElementById('persistent-text');
      if (oldPersistentText && currentPage !== 4) { // Only keep on page 5 (index 4)
        cleanupElement(oldPersistentText);
      }
    }
    
    function clearAllTimeouts() {
      // Clear all tracked timeouts
      lineRevealTimeouts.forEach(timeout => clearTimeout(timeout));
      lineRevealTimeouts = [];
      
      filmByTimeouts.forEach(timeout => clearTimeout(timeout));
      filmByTimeouts = [];
      
      if (audioTimeout) {
        clearTimeout(audioTimeout);
        audioTimeout = null;
      }
      
      // Clear animation frames
      if (currentAnimationFrame) {
        cancelAnimationFrame(currentAnimationFrame);
        currentAnimationFrame = null;
      }
    }
    
    // Optimized animation functions using requestAnimationFrame
    function createRAFAnimation(callback, interval = 100) {
      let lastTime = 0;
      let animationId = null;
      
      function animate(currentTime) {
        if (currentTime - lastTime >= interval) {
          const shouldContinue = callback(currentTime - lastTime);
          lastTime = currentTime;
          
          if (shouldContinue === false) {
            currentAnimationFrame = null;
            return;
          }
        }
        
        animationId = requestAnimationFrame(animate);
        currentAnimationFrame = animationId;
      }
      
      animationId = requestAnimationFrame(animate);
      currentAnimationFrame = animationId;
      
      return () => {
        if (animationId) {
          cancelAnimationFrame(animationId);
          currentAnimationFrame = null;
        }
      };
    }

    // Simple image functions for slides 5 and 6 only
    function addCannesPhoto() {
      // Remove any existing images first
      removeAllImages();
      
      // Create container for Cannes photo
      const imageContainer = document.createElement('div');
      imageContainer.id = 'cannes-photo-container';
      imageContainer.style.cssText = `
        position: fixed !important;
        top: 50% !important;
        left: 50% !important;
        transform: translate(-50%, -50%) !important;
        max-width: 75vw !important;
        max-height: 75vh !important;
        width: 75vw !important;
        height: 75vh !important;
        z-index: 1 !important;
        pointer-events: none !important;
        overflow: hidden !important;
      `;
      document.body.appendChild(imageContainer);
      
      // Add Cannes photo
      const img = document.createElement('img');
      img.id = 'cannes-photo';
      img.src = 'PHOTOS/photo_cannes.png.jpeg';
      img.style.cssText = `
        width: 100% !important;
        height: 100% !important;
        max-width: none !important;
        max-height: none !important;
        object-fit: contain !important;
        filter: brightness(0.8) sepia(1) hue-rotate(60deg) saturate(3.0) !important;
        display: block !important;
        opacity: 0 !important;
        transition: opacity 0.4s ease-in-out !important;
      `;
      imageContainer.appendChild(img);
      
      // CRT-style fade-in effect with brightness flash
      setTimeout(() => {
        img.style.opacity = '1';
        // Add brightness flash effect with intense glow
        img.style.filter = 'brightness(1.2) sepia(1) hue-rotate(60deg) saturate(3.0)';
        img.style.boxShadow = 'inset 0 0 50px rgba(0, 255, 0, 0.6), 0 0 30px rgba(0, 255, 0, 0.4)';
        setTimeout(() => {
          img.style.filter = 'brightness(0.8) sepia(1) hue-rotate(60deg) saturate(3.0)';
          img.style.boxShadow = 'none';
        }, 200);
      }, 50);
      
      console.log('Cannes photo added to slide 5');
    }
    
    function addArrestPhoto() {
      // Remove any existing images first
      removeAllImages();
      
      // Create container for Arrest photo
      const imageContainer = document.createElement('div');
      imageContainer.id = 'arrest-photo-container';
      imageContainer.style.cssText = `
        position: fixed !important;
        top: 65% !important;
        left: 50% !important;
        transform: translate(-50%, -50%) !important;
        max-width: 75vw !important;
        max-height: 75vh !important;
        width: 75vw !important;
        height: 75vh !important;
        z-index: 0 !important;
        pointer-events: none !important;
        overflow: hidden !important;
      `;
      document.body.appendChild(imageContainer);
      
      // Add Arrest photo
      const img = document.createElement('img');
      img.id = 'arrest-photo';
      img.src = 'PHOTOS/photo_arrest.webp';
      img.style.cssText = `
        width: 100% !important;
        height: 100% !important;
        max-width: none !important;
        max-height: none !important;
        object-fit: contain !important;
        filter: brightness(0.8) sepia(1) hue-rotate(60deg) saturate(3.0) !important;
        display: block !important;
        opacity: 0 !important;
        transition: opacity 0.4s ease-in-out !important;
      `;
      imageContainer.appendChild(img);
      
      // CRT-style fade-in effect
      setTimeout(() => {
        img.style.opacity = '0.4';
      }, 50);
      
      console.log('Arrest photo added to slide 5');
    }
    
    function addCollateralPhoto() {
      // Remove any existing images first
      removeAllImages();
      
      // Create container for Collateral photo
      const imageContainer = document.createElement('div');
      imageContainer.id = 'collateral-photo-container';
      imageContainer.style.cssText = `
        position: fixed !important;
        top: 50% !important;
        left: 50% !important;
        transform: translate(-50%, -50%) !important;
        max-width: 75vw !important;
        max-height: 75vh !important;
        width: 75vw !important;
        height: 75vh !important;
        z-index: 0 !important;
        pointer-events: none !important;
        overflow: hidden !important;
      `;
      
      // Add desktop-only styling with higher specificity
      const style = document.createElement('style');
      style.textContent = `
        @media (min-width: 769px) {
          #collateral-photo-container {
            z-index: 0 !important;
          }
          #collateral-photo {
            display: block !important;
            opacity: 0.35 !important;
            filter: brightness(0.7) sepia(1) hue-rotate(60deg) saturate(2.0) !important;
          }
        }
        @media (max-width: 768px) {
          #collateral-photo-container {
            z-index: 1 !important;
          }
          #collateral-photo {
            display: block !important;
            opacity: 0.35 !important;
            filter: brightness(0.7) sepia(1) hue-rotate(60deg) saturate(2.0) !important;
          }
        }
        /* Override any conflicting CSS rules */
        #collateral-photo-container #collateral-photo {
          display: block !important;
          position: relative !important;
        }
      `;
      document.head.appendChild(style);
      document.body.appendChild(imageContainer);
      
      // Add Collateral photo
      const img = document.createElement('img');
      img.id = 'collateral-photo';
      img.src = 'PHOTOS/photo_collateral_crop.jpg';
      img.style.cssText = `
        width: 100% !important;
        height: 100% !important;
        max-width: none !important;
        max-height: none !important;
        object-fit: contain !important;
        filter: brightness(0.35) sepia(1) hue-rotate(60deg) saturate(2.0) !important;
        display: block !important;
        opacity: 0 !important;
        transition: opacity 0.4s ease-in-out !important;
      `;
      imageContainer.appendChild(img);
      
      // CRT-style fade-in effect with brightness flash
      setTimeout(() => {
        img.style.opacity = '1';
        // Add brightness flash effect with intense glow
        img.style.filter = 'brightness(0.6) sepia(1) hue-rotate(60deg) saturate(2.0)';
        img.style.boxShadow = 'inset 0 0 50px rgba(0, 255, 0, 0.6), 0 0 30px rgba(0, 255, 0, 0.4)';
        setTimeout(() => {
          img.style.filter = 'brightness(0.35) sepia(1) hue-rotate(60deg) saturate(2.0)';
          img.style.boxShadow = 'none';
        }, 200);
      }, 50);
      
      console.log('Collateral photo added - should be behind text and dimmed on desktop');
      console.log('Desktop z-index: collateral=0, text=1');
      console.log('Mobile z-index: collateral=1, text=1');
    }
    
    function addCorreaPhoto() {
      // Remove any existing images first
      removeAllImages();
      
      // Create container for Correa photo
      const imageContainer = document.createElement('div');
      imageContainer.id = 'correa-photo-container';
      imageContainer.style.cssText = `
        position: fixed !important;
        top: 75% !important;
        left: 50% !important;
        transform: translate(-50%, -50%) !important;
        max-width: 75vw !important;
        max-height: 75vh !important;
        width: 75vw !important;
        height: 75vh !important;
        z-index: 0 !important;
        pointer-events: none !important;
        overflow: hidden !important;
      `;
      document.body.appendChild(imageContainer);
      
      // Add Correa photo
      const img = document.createElement('img');
      img.id = 'correa-photo';
      img.src = 'PHOTOS/photo_correa.jpg';
      img.style.cssText = `
        width: 100% !important;
        height: 100% !important;
        max-width: none !important;
        max-height: none !important;
        object-fit: contain !important;
        filter: brightness(0.8) sepia(1) hue-rotate(60deg) saturate(3.0) !important;
        display: block !important;
        opacity: 0 !important;
        transition: opacity 0.4s ease-in-out !important;
      `;
      imageContainer.appendChild(img);
      
      // CRT-style fade-in effect
      setTimeout(() => {
        img.style.opacity = '0.6';
      }, 50);
      
      console.log('Correa photo added to slide 4');
    }
    
    
    function removeAllImages() {
      // Remove Cannes photo
      const cannesContainer = document.getElementById('cannes-photo-container');
      if (cannesContainer) {
        cannesContainer.remove();
      }
      
      // Remove Arrest photo
      const arrestContainer = document.getElementById('arrest-photo-container');
      if (arrestContainer) {
        arrestContainer.remove();
      }
      
      // Remove Correa photo
      const correaContainer = document.getElementById('correa-photo-container');
      if (correaContainer) {
        correaContainer.remove();
      }
      
      // Remove Collateral photo
      const collateralContainer = document.getElementById('collateral-photo-container');
      if (collateralContainer) {
        collateralContainer.remove();
      }
      
      // Remove 6BDM subtitle element
      const bdmSubtitle = document.getElementById('bdm-subtitle');
      if (bdmSubtitle) {
        bdmSubtitle.remove();
      }
      
      // Remove any other images
      document.querySelectorAll('#page img').forEach(img => {
        img.remove();
      });
    }
    
    
    // Image mode functions removed - no more text container adjustments
    
    
    // Complex image search functions removed

    
      function truncateTextToFit(element, text) {
      // Simply set the content without dynamic page splitting
      element.textContent = text;
      }

    /* ================== SCRAMBLE ================== */
    
    // Function to type subtitle text character by character (typewriter effect)
    function decodeSubtitle(element, baseText, subtitleText, onComplete) {
      // Check if we should even start typing (page might have changed)
      if (!shouldContinueTyping) {
        console.log('🛑 Typing cancelled - page navigation detected');
        return;
      }
      
      // Clear any existing typing animation first
      if (currentTypingInterval) {
        clearInterval(currentTypingInterval);
        currentTypingInterval = null;
        console.log('🧹 Cleared previous typing animation');
      }
      
      let charIndex = 0;
      const len = subtitleText.length;
      
      console.log('Starting subtitle typewriter animation...');
      
      currentTypingInterval = setInterval(() => {
        // Check if we should continue typing
        if (!shouldContinueTyping) {
          console.log('🛑 Typing cancelled mid-animation');
          clearInterval(currentTypingInterval);
          currentTypingInterval = null;
          return;
        }
        
        // Show characters up to current index
        const currentText = subtitleText.substring(0, charIndex + 1);
        element.textContent = baseText + currentText;
        
        
        charIndex++;
        if (charIndex >= len) {
          clearInterval(currentTypingInterval);
          currentTypingInterval = null;
          element.textContent = baseText + subtitleText; // Final clean text
          console.log('Subtitle typewriter complete');
          if (shouldContinueTyping) { // Only call onComplete if we weren't cancelled
          onComplete && onComplete();
          }
        }
      }, 50); // 50ms per character for smooth typewriter effect
    }
    
    
    // Mobile text wrapping function - breaks long lines intelligently while preserving formatting
    function wrapTextForMobile(text) {
      const isMobile = window.innerWidth <= 768;
      if (!isMobile) return text;
      
      const lines = text.split('\n');
      const wrappedLines = [];
      const maxLineLength = 40; // Shorter for better mobile readability
      
      for (const line of lines) {
        if (line.length <= maxLineLength) {
          // Short lines stay as-is
          wrappedLines.push(line);
        } else {
          // Long lines need wrapping
          const indent = line.match(/^(\s*)/)?.[1] || '';
          const hasBullet = line.match(/^(\s*>\s*)/)?.[1] || '';
          const content = line.replace(/^(\s*>\s*)/, '');
          
          if (content.length <= maxLineLength) {
            wrappedLines.push(line);
          } else {
            // Break at natural points (spaces, punctuation)
            const words = content.split(' ');
            let currentLine = indent + hasBullet;
            let isFirstLine = true;
            
            for (const word of words) {
              const testLine = currentLine + (currentLine.endsWith(indent + hasBullet) ? '' : ' ') + word;
              
              if (testLine.length > maxLineLength) {
                if (currentLine.trim() !== (indent + hasBullet).trim()) {
                  wrappedLines.push(currentLine);
                  // For continuation lines, only add spaces, not the bullet
                  currentLine = indent + '  ' + word;
                  isFirstLine = false;
                } else {
                  currentLine += word;
                }
              } else {
                currentLine += (currentLine.endsWith(indent + hasBullet) ? '' : ' ') + word;
              }
            }
            
            if (currentLine.trim() !== (indent + hasBullet).trim()) {
              wrappedLines.push(currentLine);
            }
          }
        }
      }
      
      return wrappedLines.join('\n');
    }

    // Function to wrap years in spans for styling
    function wrapYearsInSpans(element) {
      if (!element) return;
      
      // Get the text content
      let text = element.textContent;
      
      // Regular expression to match years in format YYYY: or YYYY-YYYY:
      const yearRegex = /(\d{4}(?:-\d{4})?):/g;
      
      // Replace years with wrapped spans
      const wrappedText = text.replace(yearRegex, '<span class="year-text">$1:</span>');
      
      // Set the innerHTML with the wrapped text
      element.innerHTML = wrappedText;
    }

    function scrambleFastChunks(element, text, onComplete) {
      // Check if scrambling is disabled or if we're after slide 3
      if (scramblingDisabled || currentPage > 2) {
        console.log('🔒 Scrambling disabled - displaying text instantly (after slide 3)');
        element.textContent = text;
        wrapYearsInSpans(element);
        onComplete && onComplete();
        return;
      }
      
      if (currentInterval) {
        clearInterval(currentInterval);
        currentInterval = null;
      }
      
      if (currentAnimationFrame) {
        cancelAnimationFrame(currentAnimationFrame);
        currentAnimationFrame = null;
      }
      
      // Apply mobile text wrapping before processing (skip slides 5-6)
      if (currentPage !== 4 && currentPage !== 5) {
        text = wrapTextForMobile(text);
      }
      
      let index = 0, chunkSize = 15, scrambled = text.split(''), len = text.length;
      for (let i=0;i<len;i++) scrambled[i] = /\s/.test(text[i]) ? text[i] : chars[Math.floor(Math.random()*chars.length)];
      isAnimating = true; promptElem.style.visibility='hidden'; navMsg.style.visibility='hidden';

      // Use requestAnimationFrame for better performance
      const stopAnimation = createRAFAnimation(() => {
        const display = scrambled.slice();
        for (let i=0;i<index;i++){
          let s=i*chunkSize, e=Math.min(s+chunkSize,len);
          for (let j=s;j<e;j++) display[j]=text[j];
        }
        for (let k=index*chunkSize;k<len;k++) display[k] = /\s/.test(text[k]) ? text[k] : chars[Math.floor(Math.random()*chars.length)];
        element.textContent = display.join('');

        index++;
        if ((index*chunkSize)>=len){
          stopAnimation();
          truncateTextToFit(element, text);
          isAnimating=false;
          
          // Wrap years in spans for styling
          wrapYearsInSpans(element);
          
          // Show appropriate message based on page
          if (currentPage === 0) {
            // Slide 1 - show slide counter in nav-msg location
            navMsg.innerHTML=`SLIDE ${currentPage + 1} / ${pages.length}`;
            navMsg.style.fontSize = '1rem';
            navMsg.style.visibility='visible';
            navMsg.style.textTransform = 'uppercase';
            navMsg.style.letterSpacing = '0.1em';
            // Hide the regular slide counter
            slideCounterEl.style.visibility = 'hidden';
          } else if (currentPage === 1) {
            // Slide 2 - hide everything (invisible)
            navMsg.style.visibility = 'hidden';
            slideCounterEl.style.visibility = 'hidden';
          } else if (currentPage >= 2) {
            // On slide 3 and all subsequent slides, show slide counter in nav-msg location
            navMsg.innerHTML=`SLIDE ${currentPage + 1} / ${pages.length}`;
            navMsg.style.fontSize = '1rem';
            navMsg.style.visibility='visible';
            navMsg.style.textTransform = 'uppercase';
            navMsg.style.letterSpacing = '0.1em';
            // Hide the regular slide counter
            slideCounterEl.style.visibility = 'hidden';
          }
          
          // Check if this text contains "A FILM BY" and add delayed subtitle
          if (text.includes('A FILM BY EUGENE JARECKI')) {
            console.log('A FILM BY detected - showing video and adding delay...');
            
            // Show JA_OBIWAN video
            showVideo3Background();
            
            // Enable typing for this specific animation
            shouldContinueTyping = true;
            
            // Split the text to separate FILM BY line from 6BDM line
            const lines = text.split('\n');
            console.log('All lines:', lines);
            const filmByLine = lines.find(line => line.includes('A FILM BY EUGENE JARECKI'));
            const sixBdmLine = lines.find(line => line.includes('6BDM: JULIAN ASSANGE AND THE PRICE OF TRUTH'));
            console.log('Film by line:', filmByLine);
            console.log('6BDM line:', sixBdmLine);
            
            // Show only the FILM BY line immediately
            element.textContent = filmByLine;
            
            // Create a separate element positioned in the middle of the screen for 6BDM
            const bdmElement = document.createElement('div');
            bdmElement.id = 'bdm-subtitle';
            bdmElement.style.cssText = `
              position: fixed;
              top: 45%;
              left: 60%;
              transform: translate(-50%, -50%);
              width: 80vw;
              z-index: 100001;
              color: var(--soft);
              font-family: var(--font-family);
              font-size: 1.8rem;
              text-align: left;
              padding-left: 6rem;
              padding-right: 2rem;
              opacity: 0.9;
              pointer-events: none;
              display: block;
              white-space: pre-wrap;
              text-shadow: 0 0 2px var(--soft), 0 0 12px var(--soft);
            `;
            
            // Add mobile responsiveness
            if (window.innerWidth <= 768) {
              bdmElement.style.fontSize = '1.4rem';
              bdmElement.style.width = '90vw';
              bdmElement.style.paddingLeft = '4rem';
              bdmElement.style.left = '55%';
            }
            document.body.appendChild(bdmElement);
            
            // After 22 seconds, type 6BDM in the center of the screen
            const filmByTimeout = setTimeout(() => {
              if (sixBdmLine) {
                // Format the text with proper indentation and line breaks
                const formattedText = '6BDM:\nJULIAN ASSANGE AND THE PRICE OF TRUTH';
                // Type the formatted 6BDM text in the center element
                decodeSubtitle(bdmElement, '', formattedText, () => {
                  onComplete && onComplete();
                });
              } else {
                console.log('6BDM line not found, skipping subtitle animation');
                onComplete && onComplete();
              }
            }, 22000); // 22 second delay
            filmByTimeouts.push(filmByTimeout);
          } else {
            onComplete && onComplete();
          }
          return false; // Stop animation
        }
        return true; // Continue animation
      }, 100);
    }

    // Ultra-fast scrambling specifically for 2006 text - much faster interval
    function scrambleUltraFastChunks(element, text, onComplete) {
      // Check if scrambling is disabled or if we're after slide 3
      if (scramblingDisabled || currentPage > 2) {
        console.log('🔒 Scrambling disabled - displaying text instantly (after slide 3)');
        element.textContent = text;
        wrapYearsInSpans(element);
        onComplete && onComplete();
        return;
      }
      
      if (currentInterval) {
        clearInterval(currentInterval);
        currentInterval = null;
      }
      
      if (currentAnimationFrame) {
        cancelAnimationFrame(currentAnimationFrame);
        currentAnimationFrame = null;
      }
      
      // Apply mobile text wrapping before processing (skip slides 5-6)
      if (currentPage !== 4 && currentPage !== 5) {
        text = wrapTextForMobile(text);
      }
      
      let index = 0, chunkSize = 15, scrambled = text.split(''), len = text.length;
      for (let i=0;i<len;i++) scrambled[i] = /\s/.test(text[i]) ? text[i] : chars[Math.floor(Math.random()*chars.length)];
      isAnimating = true; promptElem.style.visibility='hidden'; navMsg.style.visibility='hidden';

      // Use requestAnimationFrame for better performance with ultra-fast timing
      const stopAnimation = createRAFAnimation(() => {
        const display = scrambled.slice();
        for (let i=0;i<index;i++){
          let s=i*chunkSize, e=Math.min(s+chunkSize,len);
          for (let j=s;j<e;j++) display[j]=text[j];
        }
        for (let k=index*chunkSize;k<len;k++) display[k] = /\s/.test(text[k]) ? text[k] : chars[Math.floor(Math.random()*chars.length)];
        element.textContent = display.join('');

        index++;
        if ((index*chunkSize)>=len){
          stopAnimation();
          truncateTextToFit(element, text);
          isAnimating=false;
          
          // Wrap years in spans for styling
          wrapYearsInSpans(element);
          
          // Show appropriate message based on page
          if (currentPage === 0) {
            // Slide 1 - show slide counter in nav-msg location
            navMsg.innerHTML=`SLIDE ${currentPage + 1} / ${pages.length}`;
            navMsg.style.fontSize = '1rem';
            navMsg.style.visibility='visible';
            navMsg.style.textTransform = 'uppercase';
            navMsg.style.letterSpacing = '0.1em';
            // Hide the regular slide counter
            slideCounterEl.style.visibility = 'hidden';
          } else if (currentPage === 1) {
            // Slide 2 - hide everything (invisible)
            navMsg.style.visibility = 'hidden';
            slideCounterEl.style.visibility = 'hidden';
          } else if (currentPage >= 2) {
            // On slide 3 and all subsequent slides, show slide counter in nav-msg location
            navMsg.innerHTML=`SLIDE ${currentPage + 1} / ${pages.length}`;
            navMsg.style.fontSize = '1rem';
            navMsg.style.visibility='visible';
            navMsg.style.textTransform = 'uppercase';
            navMsg.style.letterSpacing = '0.1em';
            // Hide the regular slide counter
            slideCounterEl.style.visibility = 'hidden';
          }
          
          onComplete && onComplete();
          return false; // Stop animation
        }
        return true; // Continue animation
      }, 25); // Ultra-fast: 25ms interval instead of 100ms (4x faster)
    }

    
    

    /* ================== LINE BY LINE REVEAL ================== */
    function revealLineByLine(element, text, onComplete) {
      // Clear any existing intervals and timeouts
      if (currentInterval) {
        clearInterval(currentInterval);
        currentInterval = null;
      }
      
      // Clear any existing line reveal timeouts
      lineRevealTimeouts.forEach(timeout => clearTimeout(timeout));
      lineRevealTimeouts = [];
      
      isAnimating = true;
      isInLineRevealMode = true;
      promptElem.style.visibility = 'hidden';
      
      const lines = text.split('\n').filter(line => line.trim() !== ''); // Remove empty lines
      element.textContent = '';
      
      // Set up line reveal state
      lineRevealState = {
        lines: lines,
        currentIndex: 0,
        element: element,
        onComplete: onComplete
      };
      
      console.log('Starting manual line-by-line reveal for 2006-2024 content...');
      console.log(`Total lines to reveal: ${lines.length}`);
      
      // Show the first line immediately
      showNextLineManual();
    }
    
    function showNextLineManual() {
      if (lineRevealState.currentIndex < lineRevealState.lines.length) {
        const currentLine = lineRevealState.lines[lineRevealState.currentIndex];
        const lineNumber = lineRevealState.currentIndex + 1;
        
        // Determine if this line should be decoded (only first line - first item only)
        const shouldDecode = lineRevealState.currentIndex === 0;
        
        if (shouldDecode) {
          console.log(`Decoding line ${lineNumber}: "${currentLine}"`);
          
          // Get current content before this line
          let previousContent = '';
          if (lineRevealState.currentIndex > 0) {
            previousContent = lineRevealState.element.textContent + '\n\n';
          }
          
          // Display line instantly
          lineRevealState.element.textContent = previousContent + currentLine;
          setTimeout(() => {
            lineRevealState.currentIndex++;
            
            // Check if we're done
            if (lineRevealState.currentIndex >= lineRevealState.lines.length) {
              console.log('All lines revealed, finishing...');
              isAnimating = false;
              isInLineRevealMode = false;
              lineRevealState.onComplete && lineRevealState.onComplete();
            } else {
              // Show navigation message for manual progression (even after decoded lines)
              navMsg.innerHTML = 'PRESS SPACEBAR<br>TO CONTINUE';
              navMsg.style.fontSize = '0.9rem';
              navMsg.style.visibility = 'visible';
            }
          }, 50);
        } else {
          // Show instantly for later lines (no decoding)
          if (lineRevealState.currentIndex > 0) {
            lineRevealState.element.textContent += '\n\n';
          }
          lineRevealState.element.textContent += currentLine;
          
          console.log(`Instantly revealed line ${lineNumber}: "${currentLine}"`);
          lineRevealState.currentIndex++;
          
          // Show navigation message for manual progression
          navMsg.innerHTML = 'PRESS SPACEBAR<br>TO CONTINUE';
          navMsg.style.fontSize = '0.9rem';
          navMsg.style.visibility = 'visible';
          
          if (lineRevealState.currentIndex >= lineRevealState.lines.length) {
            // All lines revealed
            console.log('All lines revealed, finishing...');
            isAnimating = false;
            isInLineRevealMode = false;
            lineRevealState.onComplete && lineRevealState.onComplete();
          }
        }
      }
    }

         /* ================== PAGE RENDER ================== */
  function startPage(pageIndex){
        if (pageIndex >= pages.length) pageIndex = 0;
        if (pageIndex < 0) pageIndex = pages.length - 1;
        currentPage = pageIndex;
        
        console.log(`🔍 Starting page ${pageIndex + 1}, content:`, pages[pageIndex] ? pages[pageIndex].substring(0, 100) : 'UNDEFINED');
        console.log(`🔍 DEBUG: Page ${pageIndex + 1} full content length:`, pages[pageIndex] ? pages[pageIndex].length : 0);
        console.log(`🔍 DEBUG: Total pages available:`, pages.length);
        
        // Clear all timeouts and intervals
        clearAllTimeouts();
        
        // Audio control: only allow audio on trailer slide (last slide)
        const allowedAudioSlides = [pages.length - 1]; // Trailer slide (last slide) - using 0-based index
        if (!allowedAudioSlides.includes(pageIndex)) {
          // Stop all audio when not on allowed slides
          if (currentAudio) {
            console.log(`🛑 Stopping audio - not on allowed audio slide (current: slide ${pageIndex + 1})`);
            stopCurrentAudio();
          }
          // Also stop any other audio elements
          document.querySelectorAll('audio').forEach(audio => {
            if (!audio.paused) {
              console.log('🛑 Stopping additional audio element');
              audio.pause();
              audio.currentTime = 0;
            }
          });
        }
        
        // Clear any ongoing typing animation
        if (currentTypingInterval) {
          clearInterval(currentTypingInterval);
          currentTypingInterval = null;
        }
        
        // Stop any typing animations that might be about to start
        shouldContinueTyping = false;
        
        // Clear any running scrambling animation
        if (currentInterval) {
          clearInterval(currentInterval);
          currentInterval = null;
        }
        
        // Clean up unused DOM elements and event listeners
        cleanupUnusedElements();
        
        // Reset animation state
        isAnimating = false;
        
        // Reset line reveal mode
        isInLineRevealMode = false;
        
        
        slideCounterEl.textContent = `SLIDE ${pageIndex + 1} / ${pages.length}`;
        
        // Handle slide counter visibility based on page
        if (pageIndex === 0) {
          // Slide 1 - hide regular counter, nav-msg will show slide counter after animation
          slideCounterEl.style.visibility = 'hidden';
        } else if (pageIndex === 1) {
          // Slide 2 - hide everything (invisible)
          slideCounterEl.style.visibility = 'hidden';
          navMsg.style.visibility = 'hidden';
          // Reset nav-msg styling
          navMsg.style.textTransform = '';
          navMsg.style.letterSpacing = '';
        } else if (pageIndex >= 2) {
          // On slide 3 and all subsequent slides, hide regular counter (will be shown in nav-msg after animation)
          slideCounterEl.style.visibility = 'hidden';
        }
        
        // Set data-page attribute for CSS targeting
        pageEl.setAttribute('data-page', pageIndex + 1);
        
       
      // Use simple, consistent font sizing - smaller on mobile
        const isMobile = window.innerWidth <= 768;
        
        // Set consistent text size for all slides
        el.style.fontSize = isMobile ? '0.8rem' : '1.2rem';
        
        el.style.paddingBottom = ''; // Reset any padding
       
       // Show text for all pages
       if (pageIndex < pages.length) {
         const textWrap = document.getElementById('text-wrap');
         if (textWrap) {
           textWrap.style.display = 'block';
         }
         
         el.textContent='';
         isAnimating = false;
         
         // Animation classes removed
         
        // Collateral Murder slide detection removed
         
         {
          // Use faster scrambling for page 0
          if (pageIndex === 0) {
            // Instant display for page 0 to speed up initial load
            el.textContent = isMobile ? wrapTextForMobile(pages[pageIndex]) : pages[pageIndex];
            // Wrap years in spans for styling
            wrapYearsInSpans(el);
             // Collateral Murder slide animation removed
         } else {
           console.log(`🎯 SCRAMBLE: Displaying content for slide ${pageIndex + 1}:`, pages[pageIndex].substring(0, 100));
           scrambleFastChunks(el, pages[pageIndex], () => {
           // Text displayed
           // Collateral Murder slide animation removed
         });
           }
         }
       }
       
      // Handle specific images for different slides
      console.log(`🖼️ DEBUG: Checking images for pageIndex ${pageIndex} (slide ${pageIndex + 1})`);
      if (pageIndex === 3) { // Slide 4 - Correa photo
        console.log(`🖼️ DEBUG: Adding Correa photo for slide 4`);
        addCorreaPhoto();
      } else if (pageIndex === 4) { // Slide 5 - Arrest photo
        console.log(`🖼️ DEBUG: Adding Arrest photo for slide 5`);
        addArrestPhoto();
      } else {
        console.log(`🖼️ DEBUG: Removing all images for slide ${pageIndex + 1}`);
        // Remove any existing images for other slides
        removeAllImages();
      }
       
       
      // Audio removed from last slide
       
       // Audio disabled - no sounds
       if (pageIndex + 1 === 7) {
         console.log('🔇 Audio disabled for page 7');
       }
       
       // Audio disabled - no sounds
       if (pageIndex + 1 === 10) {
         console.log('🔇 Audio disabled for page 10');
       }
       
       // Audio disabled - no sounds
       if (pageIndex + 1 === 9) {
         console.log('🔇 Audio disabled for page 9');
       }
       
       // Audio disabled - no sounds
       if (pageIndex + 1 === 13) {
         console.log('🔇 Audio disabled for page 13');
       }
       
      // Audio disabled - no sounds
      if (pageIndex + 1 === 15) {
        console.log('🔇 Audio disabled for page 15');
      }
       
       // Show video on trailer slide (last slide)
       console.log(`🔍 Debug: Current page ${pageIndex + 1}, checking for video on trailer slide...`);
       if (pageIndex + 1 === pages.length) {
         console.log('🎬 TRAILER SLIDE - Showing video...');
         showVideo3Background();
       } else {
         console.log(`🎬 Not trailer slide (current: ${pageIndex + 1}), hiding video...`);
         // Hide video on other pages
         hideVideo3Background();
         videoStartTime = null; // Reset video timing when leaving video slide
       }
       
       
       // video2 handling removed - defunct
     }

    // createPersistentText function removed - no more duplicate text

    /* ================== NAV ================== */
    let lastAdvance = 0;
    function throttle(){ const now=Date.now(); if (now-lastAdvance<300) return false; lastAdvance=now; return true; }
    function safeAdvance(){ 
      if (!throttle()) return; 
      
      // Check if we're on the trailer slide (last slide) and video hasn't played for 2 seconds yet
      if (currentPage === pages.length - 1 && videoStartTime !== null) {
        const currentTime = Date.now();
        const videoPlayTime = (currentTime - videoStartTime) / 1000; // Convert to seconds
        
        if (videoPlayTime < 2) {
          console.log(`🎬 Video slide protection: Only ${videoPlayTime.toFixed(1)}s played, need 2s to advance`);
          return; // Block navigation
        }
      }
      
      unlockAudioContext(); 
      startPage(currentPage+1); 
    }
    function goBack(){ if (!throttle()) return; unlockAudioContext(); startPage(currentPage-1); }

    document.getElementById('nav-prev').addEventListener('pointerdown', goBack, {passive:true});
    document.getElementById('nav-next').addEventListener('pointerdown', safeAdvance, {passive:true});
    document.getElementById('nav-prev').addEventListener('touchstart', goBack, {passive:true});
    document.getElementById('nav-next').addEventListener('touchstart', safeAdvance, {passive:true});
    document.getElementById('nav-prev').addEventListener('click', goBack);
    document.getElementById('nav-next').addEventListener('click', safeAdvance);
 document.addEventListener('pointerdown', (e)=>{ 
      if (e.target.id==='nav-prev'||e.target.id==='nav-next') return; 
      
      // Unlock audio context on pointer interaction
      unlockAudioContext();
      
      // Timeline reveal mode removed
      
      // If in line reveal mode, clicking anywhere advances to next line
      if (isInLineRevealMode) {
        showNextLineManual();
        return;
      }
      
      // Normal mode: Left half of screen goes back, right half goes forward
      if (e.clientX < window.innerWidth / 2) {
        goBack();
      } else {
        safeAdvance();
      }
    }, {passive:true});
     
     document.addEventListener('touchstart', (e)=>{ 
       if (e.target.id==='nav-prev'||e.target.id==='nav-next') return; 
       
       const now = Date.now();
       // Debounce touch events to prevent double-firing
       if (now - lastTouchTime < 200) return;
       lastTouchTime = now;
       
       // Unlock audio context on mobile touch
       unlockAudioContext();
       
      // Timeline reveal mode removed
       
       // If in line reveal mode, tapping anywhere advances to next line
       if (isInLineRevealMode) {
         e.preventDefault(); // Prevent default touch behavior
         showNextLineManual();
         return;
       }
       
       // Normal mode: Left half of screen goes back, right half goes forward
       if (e.touches[0].clientX < window.innerWidth / 2) {
         goBack();
       } else {
         safeAdvance();
       }
     }, {passive:false}); // Changed to passive:false to allow preventDefault
     
     // Add touchend event handler for better mobile responsiveness  
     document.addEventListener('touchend', (e)=>{ 
       if (e.target.id==='nav-prev'||e.target.id==='nav-next') return; 
       
       const now = Date.now();
       // Debounce touch events to prevent double-firing
       if (now - lastTouchTime < 200) return;
       lastTouchTime = now;
       
       // Unlock audio context on mobile touch
       unlockAudioContext();
       
      // Timeline reveal mode removed
       
       // If in line reveal mode, tapping anywhere advances to next line
       if (isInLineRevealMode) {
         e.preventDefault(); // Prevent default touch behavior
         showNextLineManual();
         return;
       }
     }, {passive:false});
document.addEventListener('click', (e)=>{ 
      if (e.target.id==='nav-prev'||e.target.id==='nav-next') return; 
      
      const now = Date.now();
      // Prevent click events that follow touch events too closely
      if (now - lastTouchTime < 300) return;
      
      // Timeline reveal mode removed
      
      // If in line reveal mode, clicking anywhere advances to next line
      if (isInLineRevealMode) {
        e.preventDefault(); // Prevent any default click behavior
        showNextLineManual();
        return;
      }
      
      // Normal mode: Left half of screen goes back, right half goes forward
      if (e.clientX < window.innerWidth / 2) {
        goBack();
      } else {
        safeAdvance();
      }
    });

    // Font system - Crisp only
    let currentFontIndex = 0; // Start with Crisp (index 0) as default
    let currentFontSize = 1.0; // Size multiplier (1.0 = 100% of base size)
    const fonts = [
      { family: 'Crisp, "Courier New", monospace', size: '1.2rem' }
    ];
    
    function cycleFontForward() {
      // Only one font available, no cycling needed
      applyCurrentFont();
    }
    
    function cycleFontBackward() {
      // Only one font available, no cycling needed
      applyCurrentFont();
    }
    
             function applyCurrentFont() {
      const selectedFont = fonts[currentFontIndex];
      console.log('Applying font:', selectedFont);
      
      // Update the CSS custom property
      document.documentElement.style.setProperty('--font-family', selectedFont.family);
      
      // Apply font family to all text elements
      const allTextElements = document.querySelectorAll('#unscramble, #prompt, #nav-msg, #nav-prev, #nav-next, #slide-counter');
      allTextElements.forEach(el => {
        if (el) {
          el.style.fontFamily = selectedFont.family;
        }
      });
      
      // Also apply to body to ensure all elements inherit the font
      document.body.style.fontFamily = selectedFont.family;
      
      console.log(`Font changed to: ${selectedFont.family}`);
    }

    window.addEventListener('keydown', (e) => {
      // Mute any keyboard sounds
      e.preventDefault();
      
      // Timeline reveal mode removed
      
      // Check if we're in line reveal mode
      if (isInLineRevealMode && (e.code==='Space'||e.code==='ArrowRight')) {
        showNextLineManual();
        return;
      }
      
      if (e.code==='Space'||e.code==='ArrowRight'){ unlockAudioContext(); startPage(currentPage+1); }
      else if (e.code==='ArrowLeft'){ unlockAudioContext(); startPage(currentPage-1); }

      const k = e.key;
      if (k==='z'||k==='Z'){ toggleGreenOverlay('full'); }
      else if (k==='x'||k==='X'){ toggleGreenOverlay('half'); }
      else if (k==='c'||k==='C'){ toggleGreenOverlay('off'); }
      else if (k==='f'||k==='F'){ toggleFullscreen(); }
      // Audio test key removed - defunct
      // video2 keyboard shortcuts removed - defunct
    });
    
    // Fullscreen functionality
    function toggleFullscreen() {
      if (!document.fullscreenElement) {
document.documentElement.requestFullscreen().catch(err => {
  console.log(`Error attempting to enable fullscreen: ${err.message}`);
});
      } else {
document.exitFullscreen();
      }
    }

    /* ================== COLOR/GLOW ================== */
    (function(){
      const navPrev = document.getElementById('nav-prev');
      const navNext = document.getElementById('nav-next');
      const terminals = [document.getElementById('unscramble'), document.getElementById('prompt'), document.getElementById('nav-msg'), navPrev, navNext, document.getElementById('slide-counter')];
      let colorIndex=1; // Default to bright green (option 2)
      const colors=['#CCCCCC','#00FF00','#66FF66'];
      function apply(){
terminals.forEach(el=>{ if(!el) return;
  el.style.color = colors[colorIndex];
  el.style.textShadow = `0 0 2.2px ${colors[colorIndex]}, 0 0 13.2px ${colors[colorIndex]}`; // Glow always on
});

// Update cursor color to match
const customCursor = document.getElementById('custom-cursor');
if (customCursor) {
  customCursor.style.background = colors[colorIndex];
  customCursor.style.boxShadow = `0 0 2.2px ${colors[colorIndex]}, 0 0 13.2px ${colors[colorIndex]}`;
}
      }
      document.addEventListener('keydown', (e)=>{
if (e.key==='1'||e.key==='2'||e.key==='3'){ colorIndex=parseInt(e.key,10)-1; apply(); }
      });
      apply();
    })();

    /* ================== MOBILE TIMELINE HANDLER ================== */
    // Dedicated mobile handler for timeline reveal - works on all mobile devices
    // Mobile timeline handler removed

    /* ================== INIT ================== */
    window.onload = () => {
      // Start presentation immediately when DOM is loaded
      startPage(0);
      
      // Mobile timeline handler removed
      
      // Initialize audio context for mobile devices
      if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
        console.log('📱 Mobile device detected - preparing audio context');
        // Pre-initialize audio context on mobile
        initAudioContext();
      }
      
      // Mute all audio by default
      document.addEventListener('keydown', (e) => {
        e.preventDefault();
      });
      
      // Mute all audio elements by default
      document.querySelectorAll('audio, video').forEach(media => {
        media.muted = true;
        media.volume = 0;
      });
      
      // Video will only show on page 15 via the page navigation logic
      // Hide any images that fail to load
      document.querySelectorAll('#page img').forEach(img => {
img.addEventListener('error', () => {
  img.style.display = 'none';
});
      });
      
      // Custom cursor functionality
      const customCursor = document.getElementById('custom-cursor');
      
      document.addEventListener('mousemove', (e) => {
customCursor.style.display = 'block';
customCursor.style.left = e.clientX - 10 + 'px';
customCursor.style.top = e.clientY - 10 + 'px';
      });
      
      document.addEventListener('mouseleave', () => {
customCursor.style.display = 'none';
      });
      
      // Apply the default font (Crisp) on page load
      applyCurrentFont();
    };
    
    // Mobile text wrapping function
    function wrapTextForMobile(text) {
      // For now, just return the text as-is since we don't need special mobile wrapping
      return text;
    }
    
    // Global green overlay toggle function
    let currentOverlayMode = 'full'; // Track current overlay mode - default to full green
    
    function toggleGreenOverlay(mode) {
      currentOverlayMode = mode; // Store the current mode
      const images = document.querySelectorAll('#page img');
      images.forEach(img => {
applyOverlayToImage(img, mode);
      });
      
    }
    
       // Apply overlay to a specific image
      function applyOverlayToImage(img, mode) {
// Check if this is photo23 (which should stay dimmed) or page 10 images (which should be darker)
const isDimmedPhoto = img.id === 'img-23';
const isDarkerPhoto = img.id.startsWith('img-10');
const baseBrightness = isDarkerPhoto ? 0.35 : (isDimmedPhoto ? 0.32 : 0.64);

if (mode === 'full') {
  img.style.filter = `grayscale(1) brightness(${baseBrightness}) contrast(1.2) sepia(1) hue-rotate(60deg) saturate(2)`;
} else if (mode === 'half') {
  img.style.filter = `brightness(${baseBrightness}) grayscale(1)`;
} else if (mode === 'off') {
  img.style.filter = `brightness(${baseBrightness})`;
}
      }
    
     
     
  </script>
  
  
  
</body>
</html>
  
  